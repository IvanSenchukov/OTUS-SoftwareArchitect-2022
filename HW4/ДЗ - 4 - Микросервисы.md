Цель:

В этом Дз вы научитесь работать с микросервисами.

  

Описание/Пошаговая инструкция выполнения домашнего задания:

1.  Для выбранного кейса оценить плюсы и минусы использования микросервисного стиля архитектуры
2.  Описать декомпозицию на микросервисы.  
    Для каждого сервиса описать

1.  Название и краткое описание
2.  Запросы
3.  Команды
4.  События
5.  Зависимости от других сервисов




# [Проверь свою работу](http://nealford.com/katas/kata?id=CheckYourWork "Check Your Work")

* Статус: На согласовании 
* Комиссия: Иван Сенчуков
* Дата: 2022-08-09

Technical Story: OTUS-SA-HW-4

## Контекст и описание проблемы

Университет значительно расширил свой курс по Компьютерным наукам и хочет иметь возможность автоматизировать процесс простановки оценок для простых задач по программированию.

Требования:
- У студентов должна быть возможность загружать исходные коды своих решений в систему для их запуска, проверки и оценки.
- Оценки и запуски должны быть сохранены и доступны для аудита.
- Применяемая система антиплагиата должна включать в себя сравнение с решениями других студентов, а также отправку решений на проверку в сервис (TurnItIn)
- Система должна быть интегрирована с текущей Системой Управления Учебный Процессом университета (Learning Management System, LMS).
- Преподаватели устанавливают конечную дату приёма решений на проверку, после которой все загруженные решения отклоняются.
- Студенты имеют возможность загружать столько решений, сколько им нужно для улучшения своих оценок.
- Преподаватели определяют критерии оценки, которые могут включать в себя метрики и/или тесты.

Дополнительный контекст:
- LMS система университета основана на мэйнфрейме. Внесение изменений в неё очень затратно.
- Оценки проверяются каждый год государственным регулирующим органом.
- У университета есть очень маленький бюджет на IT, поскольку в настоящий момент происходит постройка дополнительного стадиона для игр в мяч.
- Университет считается передовым с точки зрения компьютерных наук.


Для указанного кейса оценить плюсы и минусы использования микросервисного стиля архитектуры

## Архитектурные драйверы 

* Масштабируемость в случае возникновения пиковых нагрузок;
* Удобство поддерживания;


## Критические сценарии и критические атрибуты качества

- Все студенты решили одновременно сдать все свои работы (последний день перед сдачей - 300 чел. х 10 заданий х 10 попыток = 30000 в течение трёх часов);
- Поддержка системы силами сотрудников университета;
	- Первое развёртывание системы;
	- Восстановление системы после отказа;
	- Отладка ошибок;
	- Установка обновлений;

## Рассматриваемые варианты

* Реализация решения с использованием микросервисного стиля архитектуры
* Реализация решения с использованием монолитного стиля архитектуры
* Реализация решения с использованием нескольких сервисов (без использования полноценной инфраструктуры микросервисов)

## Принятое решение

Принятое решение - Реализация решения с использованием нескольких сервисов (без использования полноценной инфраструктуры микросервисов)

В отличие от варианта 1 - Реализация решения с использованием микросервисного стиля архитектуры - принятое решение кажется более простым для освоения. Низкая сложность системы позволяет сгладить такие недостатки этого решения, как сложность отладки и сложная установка обновлений.

В отличие от варианта 2 - Реализация решения с использованием монолитного стиля архитектуры - принятое решение выглядит менее удобным в поддержке, однако выигрывает с точки зрения масштабируемости. Высокая вероятность возникновения пиковых нагрузок на приложение подчёркивает весомость этого аргумента. 

### Положительные последствия 

* В случае пиковых нагрузок система будет иметь хорошие возможности для масштабирования;
* Поддержка системы будет под силу непрофессиональным администраторам - сотрудникам университета;

### Негативные последствия 

* Наличие дополнительных сложностей, связанных с необходимостью поддержания нескольких сервисов;
* Отсутствие инструментов, призванных уменьшить сложность поддержки микросервисных приложений;

## Оценка предложенных вариантов 

### Реализация решения с использованием микросервисного стиля архитектуры

*  Все студенты решили одновременно сдать все свои работы (последний день перед сдачей - 300 чел. х 10 заданий х 10 попыток = 30000 в течение трёх часов) - **Хорошо**, поскольку модули проверки заданий могут быть быстро смасштабированы в случае пиковой нагрузки;
* Поддержка системы силами сотрудников университета:
	* Первое развёртывание системы - **плохо**, поскольку сотрудникам университета, кроме основных компонентов системы, необходимо разобраться с инфраструктурой микросервисов;
	* Восстановление системы после отказа - **Хорошо**, поскольку восстановление отдельных компонентов системы при использовании микросервисного стиля архитектуры упрощается;
	* Отладка ошибок - **плохо**, поскольку затруднён запуск сценариев для отладки.
	* Установка обновлений - хорошо, поскольку при использовании микросервисного стиля архитекруры используется CI/CD

### Реализация решения с использованием монолитного стиля архитектуры

- Все студенты решили одновременно сдать все свои работы (последний день перед сдачей - 300 чел. х 10 заданий х 10 попыток = 30000 в течение трёх часов) - **плохо**, поскольку при масшабировании необходимого нам функционала (проверки заданий), будет также смасштабирован весь остальной функционал (веб-приложение, внесения заданий на проверку, аудит Государственного Регулирующего Органа и т.д.);
- Поддержка системы силами сотрудников университета:
	- Первое развёртывание системы - хорошо, поскольку из всех предложенных вариантов, в текущем решении для первого развёртывания требуется меньше всего усилий.
	- Восстановление системы после отказа - хорошо, нужно поднять только приложение и базу данных;
	- Отладка ошибок - хорошо, поскольку можно запустить все ошибочные сценарии в одном приложении из одних исходных данных. Все логи в одном месте. Доступен одновременно весь код для отладки.
	- Установка обновлений - плохо - для установки обновления необходимо будет остановить всё приложение. Установка займёт больше времени, чем при установке всех сервисов отдельно.

### Реализация решения с использованием нескольких сервисов (без полноценной инфраструктуры микросервисов)

* Все студенты решили одновременно сдать все свои работы (последний день перед сдачей - 300 чел. х 10 заданий х 10 попыток = 30000 в течение трёх часов) - хорошо, поскольку в качестве отдельного сервиса можно вынести функционал, который требует масштабирования;
- Поддержка системы силами сотрудников университета;
	- Первое развёртывание системы - Хорошо - по причине простоты системы количество компонентов относительно решения с монолитом увеличится незначительно;
	- Восстановление системы после отказа - хорошо - по причине низкой сложности системы сложности с локализацией ошибки не будет;
	- Отладка ошибок - плохо, потому что затруднён запуск сценариев для отладки;
	- Установка обновлений - плохо, поскольку для установки обновления необходимо будет остановить все сервисы;



# Описание декомпозиции на микросервисы

В качестве паттерна декомпозиции на микросервисы используем "разбиение по бизнес-возможностям".

Выделим основные бизнес-возможности приложения:
- Оформление, назначение, представление задания;
- Функциональная проверка решения;
- Проверка решения на антиплагиат;
- Проведение Аудита;



Предлагается следующий вариант декомпозиции на микросервисы:

# 1. programming-task-service

## Краткое описание сервиса

Сервис оформления, назначения, просмотра заданий, а также загрузки и ревью переданных решений студентов и результатов их проверки;

## Запросы
- getTasks() - Просмотр всех заданий;
- getTasks(Professor) - Просмотр заданий, созданных Преподавателем;
- getTasks(Student) - Просмотр заданий, назначенных Студенту;
- getTasks(Group) - Просмотр заданий, назначенных Группе Студентов;
- getTask(TaskId) - Просмотр детальной информации о задании;
- getSolutionsStudent) - Просмотр решений, представленных студентом;
- getSolution(SolutionId) - Просмотр решения задания;

## Команды
- createTask(Task) - Создание задания
- assignTask(Student / Group) - Назначение задания на студента;
- assignTask(Group) - Назначение задания на группу;
- updateTaskGradingCriteria(Task, GradingCriteria) - Обновление Критериев Оценки задачи;
- updateDueDate(Task, Date) - Обновление Конечной даты выполнения задания;
- updateDueDate(Task, Date, Student) - Обновление Конечной даты выполнения задания для конкретного студента (в случае уважительной причины);
- SubmitSolution(Solution) - сдать Решение на проверку;
- ReCheckSolution(SolutionId) - Запустить повторную проверку  Решения;

## События
- Генерируемые
	- solution-ready-for-functional-check - Решение готово к проведению функциональных проверок;
	- solution-ready-for-plagiarism-check - Решение готово к проведению проверок на антиплагиат;
	- solution-graded - Оповещение LMS о том, что решение получило оценку;
- Потребляемые
	- functional-check-completed - Завершена функциональная проверка Решения;
	- plagiarism-check-completed - Завершена проверка Решения на Антиплагиат;

## Зависимости от других сервисов
- База данных
- Брокер сообщений


# 2. functional-check-service

## Краткое описание сервиса
Сервис функциональной проверки решений студентов. Здесь производится запуск решений в разных средах, выполнение тестов и формирование протокола о результатах проверки.

## Запросы
- Нет

## Команды
- checkSolution(Solution) - Синхронный вызов проверки Решения

## События
- Генерируемые
	- functional-check-completed - Завершена функциональная проверка Решения
- Потребляемые
	- solution-ready-for-functional-check - Решение готово к проведению функциональных проверок;
## Зависимости от других сервисов

# 3. plagiarism-check-service

## Краткое описание сервиса
Сервис проверки решений студентов на антиплагиат.

## Запросы
- Нет

## Команды
- checkSolution(Solution) - Синхронный вызов проверки Решения;

## События
- Генерируемые
	- plagiarism-check-completed - Завершена проверка Решения на Антиплагиат
- Потребляемые
	- solution-ready-for-plagiarism-check - Решение готово к проведению проверок на антиплагиат;

## Зависимости от других сервисов
- База данных решений
- Сервис Антиплагиата TurnItIn

# 4. state-audit-service

## Краткое описание сервиса
Сервис проведения аудита Государственным Регулирующим Органом

## Запросы

## Команды
- buildAuditInfo(Year) - Предоставить данные по аудиту за переданный год;

## События

## Зависимости от других сервисов
База данных решений